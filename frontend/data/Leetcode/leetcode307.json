{
  "ID": "leetcode307",
  "coding_practice": [
    {
      "title": "Range Sum Query - Mutable",
      "description": "Given an integer array nums, handle multiple queries of the following types:\n\nUpdate the value of an element in nums.\nCalculate the sum of the elements of nums between indices left and right inclusive where left <= right.\nImplement the NumArray class:\n\n1. NumArray(int[] nums) Initializes the object with the integer array nums.\n2. void update(int index, int val) Updates the value of nums[index] to be val.\n3. int sumRange(int left, int right) Returns the sum of the elements of nums between indices left and right inclusive (i.e. nums[left] + nums[left + 1] + ... + nums[right]).",
      "examples": [
        {
          "input": "[\"NumArray\", \"sumRange\", \"update\", \"sumRange\"], [[[1, 3, 5]], [0, 2], [1, 2], [0, 2]]",
          "output": "[null, 9, null, 8]",
          "explanation": "NumArray numArray = new NumArray([1, 3, 5]);\nnumArray.sumRange(0, 2); // return 1 + 3 + 5 = 9\nnumArray.update(1, 2);   // nums = [1, 2, 5]\nnumArray.sumRange(0, 2); // return 1 + 2 + 5 = 8"
        }
      ],
      "constraints": "1 <= nums.length <= 3 * 10^4\n-100 <= nums[i] <= 100\n0 <= index < nums.length\n-100 <= val <= 100\n0 <= left <= right < nums.length\nAt most 3 * 10^4 calls will be made to update and sumRange.",
      "solution": "class NumArray:\n\n    def __init__(self, nums):\n        self.n = len(nums)\n        self.nums = nums[:]\n        # 使用 Binary Indexed Tree (Fenwick Tree)\n        self.tree = [0] * (self.n + 1)\n        for i in range(self.n):\n            self._update_tree(i + 1, nums[i])\n\n    def _update_tree(self, i, val):\n        while i <= self.n:\n            self.tree[i] += val\n            i += i & -i\n\n    def update(self, index, val):\n        diff = val - self.nums[index]\n        self.nums[index] = val\n        self._update_tree(index + 1, diff)\n\n    def sumRange(self, left, right):\n        return self._query(right + 1) - self._query(left)\n\n    def _query(self, i):\n        res = 0\n        while i > 0:\n            res += self.tree[i]\n            i -= i & -i\n        return res",
      "explanation": "1. 使用 Binary Indexed Tree (Fenwick Tree) 來高效處理區間和查詢與更新操作。\n2. 初始化時建立 tree 陣列，並將每個 nums[i] 加入 tree 中。\n3. update(index, val) 計算差值 diff，更新 tree。\n4. sumRange(left, right) 使用 _query 計算前綴和，再用 prefix[right+1] - prefix[left] 得到區間和。\n5. 所有操作的時間複雜度為 O(log n)。",
      "tag": "520",
      "difficult": "medium"
    }
  ]
}
